<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ccScoreSearch - å®¡è®¡2501ç­é«˜æ•°æˆç»©æŸ¥è¯¢ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #4A6FFF;
            --secondary-color: #FF7B54;
            --accent-color: #6C5CE7;
            --success-color: #00B894;
            --warning-color: #FDCB6E;
            --danger-color: #E17055;
            --background-color: #F8F9FA;
            --card-background: #FFFFFF;
            --text-primary: #2D3436;
            --text-secondary: #636E72;
            --border-radius: 16px;
            --shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: var(--background-color);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
            color: var(--text-primary);
            background-image:
                radial-gradient(circle at 15% 50%, rgba(74, 111, 255, 0.05) 0%, transparent 25%),
                radial-gradient(circle at 85% 30%, rgba(255, 123, 84, 0.05) 0%, transparent 25%);
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 30px 20px;
        }

        .header h1 {
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 8px;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header .subtitle {
            font-size: 1.1em;
            color: var(--text-secondary);
            font-weight: 400;
            margin-bottom: 16px;
        }

        .blessing {
            margin-top: 16px;
            font-size: 1.1em;
            color: var(--secondary-color);
            font-weight: 500;
            min-height: 28px;
            transition: opacity 0.5s ease;
            font-style: italic;
        }

        .glass-card {
            background: var(--card-background);
            border-radius: var(--border-radius);
            padding: 30px;
            margin-bottom: 24px;
            box-shadow: var(--shadow);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .glass-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.12);
        }

        .search-section {
            text-align: center;
        }

        .search-box {
            display: flex;
            gap: 12px;
            max-width: 500px;
            margin: 0 auto 20px;
        }

        .search-input {
            flex: 1;
            padding: 16px 20px;
            border: 2px solid rgba(0, 0, 0, 0.08);
            border-radius: var(--border-radius);
            font-size: 16px;
            outline: none;
            transition: all 0.3s ease;
            background: var(--card-background);
            font-family: inherit;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.04);
        }

        .search-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 4px 15px rgba(74, 111, 255, 0.15);
        }

        .btn {
            padding: 16px 28px;
            border: none;
            border-radius: var(--border-radius);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: inherit;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
            box-shadow: 0 4px 15px rgba(74, 111, 255, 0.3);
        }

        .btn-secondary {
            background: rgba(0, 0, 0, 0.03);
            color: var(--text-primary);
            border: 1px solid rgba(0, 0, 0, 0.08);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(74, 111, 255, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .quick-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .student-list {
            max-height: 500px;
            overflow-y: auto;
        }

        .student-item {
            padding: 16px 20px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.06);
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 12px;
            margin: 4px 0;
            display: flex;
            align-items: center;
            gap: 12px;
            position: relative;
        }

        .student-item:hover {
            background: rgba(74, 111, 255, 0.05);
            transform: translateX(5px);
        }

        /* éœ‡åŠ¨åŠ¨ç”» */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-3px); }
            75% { transform: translateX(3px); }
        }

        .student-item.shake {
            animation: shake 0.5s ease-in-out;
        }

        .student-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .student-item:last-child {
            border-bottom: none;
        }

        .permission-hint {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.8em;
            color: var(--text-secondary);
            background: rgba(0, 0, 0, 0.03);
            padding: 4px 8px;
            border-radius: 8px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .student-item:hover .permission-hint {
            opacity: 1;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-item {
            text-align: center;
            padding: 24px;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            color: white;
            border-radius: var(--border-radius);
            box-shadow: 0 6px 20px rgba(74, 111, 255, 0.2);
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: 700;
            margin: 8px 0;
        }

        .grade-distribution {
            margin-top: 24px;
        }

        .grade-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.06);
            align-items: center;
        }

        .grade-item:last-child {
            border-bottom: none;
        }

        .report-section {
            display: none;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 16px;
            padding: 16px;
            background: rgba(0, 0, 0, 0.02);
            border-radius: var(--border-radius);
        }

        .score-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 24px 0;
        }

        .score-card {
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            color: white;
            padding: 24px;
            border-radius: var(--border-radius);
            text-align: center;
            box-shadow: 0 6px 20px rgba(74, 111, 255, 0.2);
        }

        .score-value {
            font-size: 3em;
            font-weight: 700;
            margin: 8px 0;
        }

        .analysis-section {
            margin: 24px 0;
        }

        .analysis-item {
            padding: 20px;
            margin: 12px 0;
            background: rgba(0, 0, 0, 0.02);
            border-radius: var(--border-radius);
            border-left: 4px solid var(--primary-color);
        }

        .suggestion-item, .scenario-item {
            padding: 16px 20px;
            margin: 8px 0;
            background: rgba(0, 187, 148, 0.1);
            border-radius: var(--border-radius);
            border-left: 4px solid var(--success-color);
        }

        .warning-item {
            padding: 16px 20px;
            margin: 8px 0;
            background: rgba(253, 203, 110, 0.1);
            border-radius: var(--border-radius);
            border-left: 4px solid var(--warning-color);
        }

        .danger-item {
            padding: 16px 20px;
            margin: 8px 0;
            background: rgba(225, 112, 85, 0.1);
            border-radius: var(--border-radius);
            border-left: 4px solid var(--danger-color);
        }

        .loading {
            text-align: center;
            padding: 40px;
            display: none;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(74, 111, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .section-title {
            font-size: 1.4em;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--text-primary);
        }

        .student-name {
            font-size: 1.8em;
            font-weight: 700;
            margin-bottom: 8px;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .grade-badge {
            display: inline-block;
            padding: 4px 12px;
            background: rgba(74, 111, 255, 0.1);
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
            margin-left: 8px;
            color: var(--primary-color);
        }

        .no-exam-card {
            background: linear-gradient(135deg, var(--warning-color), var(--danger-color));
        }

        .exam-type-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 600;
            margin-left: 8px;
        }

        .exam-first {
            background: rgba(0, 187, 148, 0.1);
            color: var(--success-color);
        }

        .exam-makeup {
            background: rgba(253, 203, 110, 0.1);
            color: var(--warning-color);
        }

        .exam-none {
            background: rgba(225, 112, 85, 0.1);
            color: var(--danger-color);
        }

        @media (max-width: 768px) {
            .container {
                padding: 0 16px;
            }

            .header h1 {
                font-size: 2.2em;
            }

            .search-box {
                flex-direction: column;
            }

            .quick-actions {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }

            .score-grid {
                grid-template-columns: 1fr;
            }

            .info-row {
                flex-direction: column;
                gap: 8px;
            }

            .permission-hint {
                position: static;
                transform: none;
                margin-top: 8px;
                opacity: 1;
                font-size: 0.75em;
                text-align: center;
            }
        }

        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡ */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-color);
        }

        .logo {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 18px;
        }

        .error-message {
            text-align: center;
            padding: 20px;
            color: var(--danger-color);
            background: rgba(225, 112, 85, 0.1);
            border-radius: var(--border-radius);
            margin: 20px 0;
        }

        .permission-notice {
            text-align: center;
            padding: 16px;
            margin: 16px 0;
            background: rgba(253, 203, 110, 0.1);
            border-radius: var(--border-radius);
            border-left: 4px solid var(--warning-color);
            font-size: 0.9em;
            color: var(--text-secondary);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å¤´éƒ¨ -->
        <div class="header">
            <div class="logo">
                <div class="logo-icon">cc</div>
                <h1>ScoreSearch</h1>
            </div>
            <div class="subtitle">å®¡è®¡2501ç­ Â· é«˜ç­‰æ•°å­¦æˆç»©åˆ†æç³»ç»Ÿ</div>
            <div id="blessing" class="blessing"></div>
        </div>

        <!-- æœç´¢åŒºåŸŸ -->
        <div class="glass-card search-section">
            <div class="section-title">ğŸ” æŸ¥è¯¢æˆç»©</div>
            <div class="search-box">
                <input type="text" id="searchInput" class="search-input" placeholder="è¾“å…¥å­¦å·æˆ–å§“å...">
                <button onclick="searchStudent()" class="btn btn-primary">
                    <span>æŸ¥è¯¢</span>
                </button>
            </div>
            <div class="quick-actions">
                <button onclick="showAllStudents()" class="btn btn-secondary">
                    <span>ğŸ‘¥ æ‰€æœ‰å­¦ç”Ÿ</span>
                </button>
                <button onclick="showClassStats()" class="btn btn-secondary">
                    <span>ğŸ“ˆ ç­çº§ç»Ÿè®¡</span>
                </button>
            </div>
        </div>

        <!-- åŠ è½½æç¤º -->
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <div>åŠ è½½ä¸­...</div>
        </div>

        <!-- å­¦ç”Ÿåˆ—è¡¨ -->
        <div id="studentList" class="glass-card student-list" style="display: none;">
            <div class="section-title">ğŸ‘¥ å­¦ç”Ÿåå•</div>
            <div class="permission-notice">
                âš ï¸ æ³¨æ„ï¼šæ‚¨åªèƒ½æŸ¥çœ‹è‡ªå·±çš„æˆç»©ï¼Œç‚¹å‡»å…¶ä»–åŒå­¦å°†æç¤ºæ— æƒé™
            </div>
            <div id="studentsContainer"></div>
        </div>

        <!-- ç­çº§ç»Ÿè®¡ -->
        <div id="classStats" class="glass-card" style="display: none;">
            <div class="section-title">ğŸ“Š ç­çº§ç»Ÿè®¡</div>
            <div id="statsContainer"></div>
        </div>

        <!-- æˆç»©æŠ¥å‘Š -->
        <div id="studentReport" class="glass-card report-section">
            <div id="reportContent"></div>
        </div>
    </div>

    <script>
        // ç¥ç¦è¯­æ•°ç»„ - é£è¶£å¹½é»˜ç‰ˆ
        const blessings = [
            "é«˜æ•°è™æˆ‘åƒç™¾éï¼Œæˆ‘å¾…é«˜æ•°å¦‚åˆæ‹ï½",
            "ä»Šå¤©çš„ä½ æ¯”æ˜¨å¤©æ›´åšå­¦äº†ä¸€ç‚¹ç‚¹ï¼",
            "æ•°å­¦ä¸ä¼šéª—äººï¼Œä¸ä¼šå°±æ˜¯ä¸ä¼š ğŸ˜œ",
            "é«˜æ•°æˆç»©å•ï¼šä½ çš„åŠªåŠ›ï¼Œåˆ†æ•°çœ‹å¾—è§ï¼",
            "åˆ«ä½å¤´ï¼Œçš‡å† ä¼šæ‰ï¼›åˆ«æ”¾å¼ƒï¼Œé«˜æ•°è¦è€ƒï¼",
            "å­¦ä¹ é«˜æ•°å°±åƒæ‰“æ¸¸æˆï¼Œå¤šç»ƒçº§æ‰èƒ½æ‰“bossï¼",
            "é«˜æ•°ä¸ä¼šè¾œè´Ÿæ¯ä¸€ä¸ªè®¤çœŸå¯¹å¾…å®ƒçš„äºº",
            "ä»Šå¤©ä½ é«˜æ•°äº†å—ï¼Ÿæˆç»©å•åœ¨çœ‹ç€ä½ å‘¢ï¼",
            "é«˜æ•°æˆç»©å•ï¼šä½ çš„åŠªåŠ›ï¼Œç»ˆå°†ç¾å¥½ï¼",
            "å¾®ç§¯åˆ†ä¸ä¼šï¼Œäººç”Ÿè·¯ç™½èµ°ï¼å¼€ç©ç¬‘çš„å•¦ï½"
        ];

        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        // æ›´æ–°ç¥ç¦è¯­
        function updateBlessing() {
            const blessingElement = document.getElementById('blessing');
            const randomIndex = Math.floor(Math.random() * blessings.length);
            const newBlessing = blessings[randomIndex];

            // æ·¡å‡ºæ•ˆæœ
            blessingElement.style.opacity = 0;

            setTimeout(() => {
                blessingElement.textContent = newBlessing;
                // æ·¡å…¥æ•ˆæœ
                blessingElement.style.opacity = 1;
            }, 500);
        }

        // æœç´¢å­¦ç”Ÿ
        async function searchStudent() {
            const query = document.getElementById('searchInput').value.trim();

            if (!query) {
                alert('è¯·è¾“å…¥å­¦å·æˆ–å§“åè¿›è¡ŒæŸ¥è¯¢');
                return;
            }

            showLoading(true);
            hideAllSections();

            try {
                const response = await fetch(`/api/student/${encodeURIComponent(query)}`);
                const result = await response.json();

                if (result.success) {
                    showStudentReport(result.data);
                } else {
                    document.getElementById('studentReport').style.display = 'block';
                    document.getElementById('reportContent').innerHTML = `
                        <div class="error-message">
                            <h3>âŒ æœªæ‰¾åˆ°å­¦ç”Ÿä¿¡æ¯</h3>
                            <p>æœªæ‰¾åˆ°ä¸ "${query}" å¯¹åº”çš„å­¦ç”Ÿä¿¡æ¯ï¼Œè¯·æ£€æŸ¥è¾“å…¥æ˜¯å¦æ­£ç¡®ã€‚</p>
                            <p>æç¤ºï¼šå¯ä»¥ç‚¹å‡»"æ‰€æœ‰å­¦ç”Ÿ"æŒ‰é’®æŸ¥çœ‹å®Œæ•´åå•</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('studentReport').style.display = 'block';
                document.getElementById('reportContent').innerHTML = `
                    <div class="error-message">
                        <h3>âŒ æŸ¥è¯¢å¤±è´¥</h3>
                        <p>æŸ¥è¯¢è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ç¨åå†è¯•ã€‚</p>
                    </div>
                `;
            } finally {
                showLoading(false);
            }
        }

        // æ˜¾ç¤ºæ‰€æœ‰å­¦ç”Ÿ
        async function showAllStudents() {
            showLoading(true);
            hideAllSections();

            try {
                const response = await fetch('/api/students');
                const result = await response.json();

                if (result.success) {
                    displayStudentList(result.data);
                } else {
                    alert('è·å–å­¦ç”Ÿåˆ—è¡¨å¤±è´¥');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('è·å–å­¦ç”Ÿåˆ—è¡¨å¤±è´¥');
            } finally {
                showLoading(false);
            }
        }

        // æ˜¾ç¤ºç­çº§ç»Ÿè®¡
        async function showClassStats() {
            showLoading(true);
            hideAllSections();

            try {
                const response = await fetch('/api/class_stats');
                const result = await response.json();

                if (result.success) {
                    displayClassStats(result.data);
                } else {
                    alert('è·å–ç­çº§ç»Ÿè®¡å¤±è´¥');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('è·å–ç­çº§ç»Ÿè®¡å¤±è´¥');
            } finally {
                showLoading(false);
            }
        }

        // éšè—æ‰€æœ‰å†…å®¹åŒºåŸŸ
        function hideAllSections() {
            document.getElementById('studentList').style.display = 'none';
            document.getElementById('classStats').style.display = 'none';
            document.getElementById('studentReport').style.display = 'none';
        }

        // æ˜¾ç¤ºå­¦ç”Ÿåˆ—è¡¨
        function displayStudentList(students) {
            const container = document.getElementById('studentsContainer');
            container.innerHTML = '';

            students.forEach(student => {
                const item = document.createElement('div');
                item.className = 'student-item';

                // è·å–å§“åçš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä½œä¸ºå¤´åƒ
                const firstChar = student.student_name.charAt(0);

                item.innerHTML = `
                    <div class="student-avatar">${firstChar}</div>
                    <div>
                        <strong>${student.student_name}</strong>
                        <div style="font-size: 0.9em; color: var(--text-secondary); margin-top: 4px;">
                            ${student.student_id}
                        </div>
                    </div>
                    <div class="permission-hint">ä»…å¯æŸ¥çœ‹æœ¬äººæˆç»©</div>
                `;

                // ä¿®æ”¹ç‚¹å‡»äº‹ä»¶ï¼šéœ‡åŠ¨å¹¶æç¤ºæ— æƒæŸ¥çœ‹
                item.onclick = () => {
                    // æ·»åŠ éœ‡åŠ¨æ•ˆæœ
                    item.classList.add('shake');

                    // 0.5ç§’åç§»é™¤éœ‡åŠ¨æ•ˆæœ
                    setTimeout(() => {
                        item.classList.remove('shake');
                    }, 500);

                    // æ˜¾ç¤ºæƒé™æç¤º
                    showPermissionHint(student.student_name);
                };

                container.appendChild(item);
            });

            document.getElementById('studentList').style.display = 'block';
        }

        // æ˜¾ç¤ºæƒé™æç¤º
        function showPermissionHint(studentName) {
            // åœ¨ç¥ç¦è¯­åŒºåŸŸæ˜¾ç¤ºæç¤º
            const blessingElement = document.getElementById('blessing');
            const originalBlessing = blessingElement.textContent;

            blessingElement.textContent = `âš ï¸ æ— æƒæŸ¥çœ‹ ${studentName} çš„æˆç»©ï¼Œè¯·è¾“å…¥è‡ªå·±çš„å­¦å·æŸ¥è¯¢`;
            blessingElement.style.color = 'var(--warning-color)';

            // 3ç§’åæ¢å¤åŸæ¥çš„ç¥ç¦è¯­
            setTimeout(() => {
                blessingElement.style.color = 'var(--secondary-color)';
                updateBlessing();
            }, 3000);
        }

        // æ˜¾ç¤ºç­çº§ç»Ÿè®¡
        function displayClassStats(stats) {
            const container = document.getElementById('statsContainer');

            let distributionHtml = '<div class="grade-distribution"><div class="section-title">ç­‰çº§åˆ†å¸ƒ</div>';
            for (const [grade, count] of Object.entries(stats.grade_distribution)) {
                const percentage = ((count / stats.total_students) * 100).toFixed(1);
                distributionHtml += `
                    <div class="grade-item">
                        <span>${grade}</span>
                        <span><strong>${count}</strong> äºº (${percentage}%)</span>
                    </div>
                `;
            }
            distributionHtml += '</div>';

            container.innerHTML = `
                <div class="stats-grid">
                    <div class="stat-item">
                        <div>å¹³å‡åˆ†</div>
                        <div class="stat-value">${stats.average_score}</div>
                        <div>åŠ æƒå¹³å‡</div>
                    </div>
                    <div class="stat-item">
                        <div>æ€»äººæ•°</div>
                        <div class="stat-value">${stats.total_students}</div>
                        <div>å·²è€ƒè¯•å­¦ç”Ÿ</div>
                    </div>
                </div>
                ${distributionHtml}
            `;

            document.getElementById('classStats').style.display = 'block';
        }

        // æ˜¾ç¤ºå­¦ç”Ÿæˆç»©æŠ¥å‘Š
        function showStudentReport(data) {
            const container = document.getElementById('reportContent');

            // æ ¹æ®è€ƒè¯•ç±»å‹è®¾ç½®æ ·å¼
            let examTypeClass = '';
            if (data.exam_type === 'ç¬¬ä¸€æ¬¡è€ƒè¯•') {
                examTypeClass = 'exam-first';
            } else if (data.exam_type === 'è¡¥è€ƒ') {
                examTypeClass = 'exam-makeup';
            } else {
                examTypeClass = 'exam-none';
            }

            let reportHtml = `
                <div class="student-name">${data.student_name}</div>

                <!-- åŸºæœ¬ä¿¡æ¯ -->
                <div class="info-row">
                    <span><strong>å­¦å·:</strong> ${data.student_id}</span>
                    <span><strong>è€ƒè¯•æƒ…å†µ:</strong>
                        <span class="exam-type-badge ${examTypeClass}">${data.exam_type}</span>
                    </span>
                </div>

                <!-- æˆç»©å¯¹æ¯” -->
                <div class="score-grid">
                    <div class="score-card ${data.exam_score === null ? 'no-exam-card' : ''}">
                        <div>æœŸä¸­è€ƒè¯•</div>
                        <div class="score-value">${data.exam_score !== null ? data.exam_score : 'â€”'}</div>
                        <div>${data.exam_grade}</div>
                    </div>
                    <div class="score-card">
                        <div>ç»¼åˆæˆç»©</div>
                        <div class="score-value">${data.weighted_score}</div>
                        <div>${data.weighted_grade}</div>
                    </div>
                </div>

                <!-- æˆç»©æ˜ç»† -->
                <div class="info-row">
                    <span><strong>å¹³æ—¶ä½œä¸š:</strong> ${data.homework_percent.toFixed(1)}åˆ† (æƒé‡40%)</span>
                    <span><strong>æœŸä¸­è€ƒè¯•:</strong> ${data.exam_score !== null ? data.exam_score + 'åˆ†' : 'æœªå‚åŠ '} (æƒé‡60%)</span>
                </div>
            `;

            // å­¦ä¹ åˆ†æ
            if (data.analysis) {
                reportHtml += `<div class="section-title">å­¦ä¹ åˆ†æ</div>`;

                if (data.analysis.strength) {
                    reportHtml += `<div class="analysis-item">âœ… ${data.analysis.strength}</div>`;
                }
                if (data.analysis.challenge) {
                    reportHtml += `<div class="analysis-item">âš ï¸ ${data.analysis.challenge}</div>`;
                }
                if (data.analysis.special_note) {
                    reportHtml += `<div class="analysis-item">ğŸ’¡ ${data.analysis.special_note}</div>`;
                }
            }

            // æ”¹è¿›å»ºè®®
            if (data.analysis && data.analysis.suggestions && data.analysis.suggestions.length > 0) {
                reportHtml += `<div class="section-title">æ”¹è¿›å»ºè®®</div>`;
                data.analysis.suggestions.forEach(suggestion => {
                    // æ ¹æ®å»ºè®®å†…å®¹ç¡®å®šæ ·å¼
                    let suggestionClass = 'suggestion-item';
                    if (suggestion.includes('âš ï¸') || suggestion.includes('éœ€è¦åŠ å¼º')) {
                        suggestionClass = 'warning-item';
                    } else if (suggestion.includes('ğŸ‘¨â€ğŸ«') || suggestion.includes('ä¸€å¯¹ä¸€è¾…å¯¼')) {
                        suggestionClass = 'danger-item';
                    }

                    reportHtml += `<div class="${suggestionClass}">${suggestion}</div>`;
                });
            }

            // æå‡ç©ºé—´
            if (data.improvement_scenarios && data.improvement_scenarios.length > 0) {
                reportHtml += `<div class="section-title">æå‡ç©ºé—´</div>`;
                data.improvement_scenarios.forEach(scenario => {
                    reportHtml += `<div class="scenario-item">${scenario}</div>`;
                });
            }

            container.innerHTML = reportHtml;
            document.getElementById('studentReport').style.display = 'block';
        }

        // å›è½¦é”®æœç´¢
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchStudent();
            }
        });

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨èšç„¦æœç´¢æ¡†
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('searchInput').focus();

            // åˆå§‹åŒ–ç¥ç¦è¯­
            updateBlessing();

            // æ¯30ç§’æ›´æ–°ä¸€æ¬¡ç¥ç¦è¯­
            setInterval(updateBlessing, 30000);
        });
    </script>
</body>
</html>